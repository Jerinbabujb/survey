{% extends 'admin/base.html' %}
{% block content %}

<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
  <!-- Add Employee -->
  <div class="bg-white shadow-lg rounded-xl p-6 hover:shadow-xl transition-shadow duration-300">
    <h2 class="text-xl font-bold mb-4">Add Employee</h2>
    <form method="post" action="/admin/employees/add" class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-1">Name</label>
        <input type="text" name="name" required class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Email</label>
        <input type="email" name="email" required class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400">
      </div>
      <button class="w-full bg-[#ad9f6f] text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">Add Employee</button>
    </form>
  </div>

  <!-- Bulk Import CSV -->
  <div class="bg-white shadow-lg rounded-xl p-6 hover:shadow-xl transition-shadow duration-300">
    <h2 class="text-xl font-bold mb-4">Bulk Import (CSV)</h2>
    <form method="post" action="/admin/employees/import" class="space-y-4">
      <textarea name="csv_rows" rows="6" class="w-full border rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="Name,Email\nAnother,person@example.com"></textarea>
      <button class="w-full bg-[#ad9f6f] text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors">Import Empoyees</button>
    </form>
  </div>

  <!-- Bulk Email -->
  <div class="bg-white shadow-lg rounded-xl p-6 hover:shadow-xl transition-shadow duration-300 space-y-4">
    <h2 class="text-xl font-bold mb-4">Bulk Email</h2>
    <form method="post" action="/admin/send-invites">
      <button class="w-full bg-[#ad9f6f] text-white px-4 py-2 rounded-md hover:bg-[#ad9f6f] transition-colors">Send Invites</button>
    </form>
    <form method="post" action="/admin/send-reminders">
      <button class="w-full bg-black text-white px-4 py-2 rounded-md hover:bg-[#000] transition-colors">Send Reminders</button>
    </form>
  </div>
</div>

<!-- Employees List -->
<div class="space-y-6">
  {% for employee in employees %}
  <div class="bg-white shadow-lg rounded-xl p-6 hover:shadow-xl transition-shadow duration-300">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-4">
      <div>
      {% if not employee.submitted_at %}
      <h3 class="text-lg font-semibold">{{ employee.name }}</h3>
  <p class="text-sm text-gray-500">{{ employee.email }}</p>
{% else %}
  <!-- Masked name -->
  <h3 class="text-lg font-semibold">
    ****
  </h3>
  <!-- Masked email -->
  <p class="text-sm text-gray-500">
    ***@{{ employee.email.split('@')[1] }}
  </p>
{% endif %}

        <p class="text-sm mt-1">
          {% if not employee.is_active %}
            <span class="text-gray-400 font-medium">Inactive</span>
          {% elif employee.submitted_at %}
            <span class="text-green-600 font-semibold">Submitted</span>
          {% else %}
            <span class="text-amber-600 font-semibold">Pending</span>
          {% endif %}
        </p>
        <p class="text-xs text-gray-500 mt-1">
          Invited: {{ employee.invited_at.strftime("%Y-%m-%d %H:%M") if employee.invited_at else "—" }}  
          | Submitted: {{ employee.submitted_at.strftime("%Y-%m-%d %H:%M") if employee.submitted_at else "—" }}
        </p>
      </div>
      <div class="flex space-x-2 mt-2 md:mt-0">
  <form method="post" action="/admin/employees/{{ employee.id }}/toggle">
    <button 
      class="text-blue-600 hover:underline disabled:opacity-50" 
      {{ 'disabled' if employee.submitted_at else '' }}
    >
      {{ 'Activate' if not employee.is_active else 'Deactivate' }}
    </button>
  </form>

  {% if employee.is_active %}
  <form method="post" action="/admin/employees/{{ employee.id }}/resend">
    <button 
      class="text-amber-600 hover:underline disabled:opacity-50" 
      {{ 'disabled' if employee.submitted_at else '' }}
    >
      Send Invite
    </button>
  </form>
  {% endif %}
</div>

    </div>

    {% if employee.question_scores %}
    <div class="overflow-x-auto mt-4">
      <table class="w-full border border-gray-200 rounded-md text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-3 py-2 text-left">Question</th>
            <th class="px-3 py-2 text-center">Score (×10)</th>
            <th class="px-3 py-2 text-center">Category</th>
          </tr>
        </thead>
        <tbody>
          {% for q in employee.question_scores %}
          <tr class="border-t">
            <td class="px-3 py-2">Q{{ q.question_no }}
              <!-- Hover box -->
      <div
        class="absolute left-0 top-full mt-2 w-72 bg-white border border-gray-200 rounded-lg shadow-lg
               text-sm text-gray-700 p-3 opacity-0 invisible
               group-hover:opacity-100 group-hover:visible transition-all duration-200 z-20"
      >
        {{ questions[q.question_no - 1] }}
      </div>

            </td>
            <td class="px-3 py-2 text-center font-medium">{{ q.score }}</td>
            <td class="px-3 py-2 text-center">
              {% if q.category == "Outstanding" %}
                <span class="text-green-700 font-semibold">{{ q.category }}</span>
              {% elif q.category == "Exceeds Target" %}
                <span class="text-blue-600 font-semibold">{{ q.category }}</span>
              {% elif q.category == "Meets Target" %}
                <span class="text-yellow-600 font-semibold">{{ q.category }}</span>
              {% else %}
                <span class="text-red-600 font-semibold">{{ q.category }}</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
  {% else %}
  <p class="text-center text-gray-500">No employees found.</p>
  {% endfor %}
</div>

{% endblock %}
